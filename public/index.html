<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <!-- <script
      src="https://code.jquery.com/jquery-3.4.1.js"
      integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
      crossorigin="anonymous"
    ></script> -->
    <!-- <script src="https://github.com/typicaljoe/taffydb/raw/master/taffy.js"></script> -->
    <link rel="stylesheet" type="text/css" href="style.css" />
    <title>eMenu - new way to order food on the go!</title>
  </head>
  <body>
    <header>Emenu</header>
    <div class="container">
      <div class="banner">lorem ipsum</div>
      <div class="main">
      <div id="menu"></div>
      <div class="input">
        <input type="text" id="item-name" placeholder="Item name :" />
        <input type="number" id="item-price" placeholder="Item price :" />
        <button id="add-btn">Add item!</button>
        <button id="del-btn">delete previous item</button>
        <button id="viw-mnu">View menu</button>
      </div>
    </div>
  </div>
    <script>
      //   var db = openDatabase("menu", "1.0", "store menu items", 65535);

      //   $(function(){
      //     $("#crt-tbl").click(function(){
      //     db.transaction(function(transaction){
      //       var sql = "CREATE TABLE menu" +
      //       "(id INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT," +
      //       "item VARCHAR(20) NOT NULL," +
      //       "quantity INT(5) NOT NULL)";
      //       transaction.executeSql(sql, undefined,
      //       function(){
      //         alert("table created!");
      //       }, function(){
      //         alert("table exists!");
      //       })
      //     })
      //   })
      // })

      let menu = [];

      const menuDiv = document.querySelector("#menu");
      const inputName = document.querySelector("#item-name");
      const inputPrice = document.querySelector("#item-price");

      document.querySelector("#add-btn").addEventListener("click", addItem);
      document
        .querySelector("#del-btn")
        .addEventListener("click", () => delItem(menu.length - 1));

      document.querySelector("#viw-mnu").addEventListener("click", function () {
        location.href = "/all.html";
    })
      //create datbase
      // let menuDb = TAFFY();
      // let div = document.querySelector(".menu");
      // function displayMenu() {
      //   let nHtml = "";
      //   document.getElementById("menu").innerHTML = "<ul>" + nHtml + "</ul>";

      //   menu.forEach(item => {
      //     nHtml += `<li> ${item.itemName} : Rs. ${item.itemPrice}
      //     <button onclick=deleteItem(item)>delete</button></li>`;

      //     // "<li>" +
      //     // item.itemName +
      //     // " : " +
      //     // "  Rs. " +
      //     // item.itemPrice +
      //     // "</li>";
      //   });
      //   // div.innerHTML += "<span>" + item.itemName + "</span>";

      //   document.getElementById("menu").innerHTML = "<ol>" + nHtml + "</ol>";
      // }
      //perfect delete funtion

      function render(items) {
        menuDiv.innerHTML = "";
        [inputName, inputPrice].forEach(input => (input.value = ""));
        items.forEach((item, index) =>
          menuDiv.append(menuElement(item, index))
        );
      }

      function menuElement(item, index) {
        const menuText = document.createElement("span");
        menuText.innerText = `${item.itemName}   -   ${item.itemPrice}`;

        const delBtn = document.createElement("button");
        delBtn.innerText = "delete item";
        delBtn.addEventListener("click", () => delItem(index));

        const itemDiv = document.createElement("div");
        [menuText, delBtn].forEach(el => itemDiv.append(el));

        return itemDiv;
      }
      // function deleteItem(item) {
      //   let index = menu.indexOf(item);
      //   menu.splice(index, 1);
      //   displayMenu();
      //   console.log(menu);
      // }

      function delItem(index) {
        menu.splice(index, 1);
        render(menu);

        const options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(menu)
        };
        fetch("/menu", options)
        .then(res => console.log(res));
      }
      // function addItem() {
      //   let itemName = document.getElementById("item-name").value;
      //   let itemPrice = document.getElementById("item-price").value;
      //   menu.push({ itemName, itemPrice }); //{itemName: itemName...}

      function addItem() {
        menu.push({
          itemName: inputName.value,
          itemPrice: inputPrice.value
        });
        // localStorage.setItem("itemName", inputName.value);
        // localStorage.setItem("itemPrice", inputPrice.value);
        // menu.forEach((item, index) =>
        //   localStorage.setItem(index, JSON.stringify(item))
        // );
        // console.log(JSON.parse(localStorage));
        console.log(menu);
        // console.log(localStorage.getItem("itemName"));
        // console.log(localStorage.getItem("itemPrice"));
        render(menu);
        const options = {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(menu)
        };
        fetch("/menu", options)
        .then(res => console.log(res));
        // console.log("fetch sent");
      }

      // menuDb.insert({ itemName, itemPrice });
      // alert(menuDb());

      //delete button
      // let removeTask = document.createElement("input");
      // removeTask.setAttribute("type", "button");
      // removeTask.setAttribute("value", "Remove");
      // removeTask.setAttribute("id", "removeButton");
      // removeTask.addEventListener(
      //   "click",
      //   function(e) {
      //     node.parentNode.removeChild(node);
      //   },
      //   false
      // );
      // node.appendChild(removeTask);

      //clear the inputs
      //   document.getElementById("item-name").value = "";
      //   document.getElementById("item-price").value = "";
      //   console.log(menu);
      //   displayMenu();
      // }

      // var db = require(quick.db);
      // db.set('userInfo', { difficulty: 'Easy' })
      // console.log(db.get(userInfo.difficulty));
    </script>
  </body>
</html>
